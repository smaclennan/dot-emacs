.SUFFIXES: .el .elc

EMACS = xemacs
VERSION = $(shell $(EMACS) -V -vanilla | cut -d' ' -f2)

.el.elc:
	$(EMACS) -batch -q -f batch-byte-compile $<

LISP = 	frame-utils.el introspector.el
ELCS = 	frame-utils.elc introspector.elc


all:	auto-autoloads.el custom-load.el

elcs:	$(ELCS)
	$(EMACS) -batch -vanilla -f batch-byte-compile custom-load.el

auto-autoloads.el: $(LISP)
	rm -f auto-autoloads.el
ifeq ($(EMACS),sxemacs)
	$(EMACS) -batch -f batch-create-autoloads .
else
  ifeq ($(VERSION),21.4)
	$(EMACS) -batch -q -no-site-file -l autoload \
		-f batch-update-directory .
  else
	$(EMACS) -batch -q -no-site-file -l autoload \
		-f batch-update-directory-autoloads introspector .
  endif
endif

custom-load.el: $(LISP)
	$(EMACS) -batch -vanilla -l cus-dep -f Custom-make-dependencies .

tags:
	etags *.el

clean:
	rm -f *.elc auto-autoloads.el custom-load.el TAGS
